{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Reproduce failed DMS task to facilitate log analysis with CloudWatch Log Insights",
    "Resources": {
        "FailedTask": {
            "Type": "AWS::DMS::ReplicationTask",
            "Properties": {
                "ReplicationTaskIdentifier": "demo3",
                "SourceEndpointArn": "arn:aws:dms:us-east-1:466711825721:endpoint:TUSARZHJSZBTDPHW6DO2MSMJSM",
                "TargetEndpointArn": "arn:aws:dms:us-east-1:466711825721:endpoint:XAQVYK272JCJLO3SHH3ZREKA6M",
                "ReplicationInstanceArn": "arn:aws:dms:us-east-1:466711825721:rep:JDXAXXTL7BASXJ2TO2ZMJLV5X4",
                "MigrationType": "full-load-and-cdc",
                "TableMappings": "{\n    \"rules\": [\n        {\n            \"rule-type\": \"selection\",\n            \"rule-id\": \"835810818\",\n            \"rule-name\": \"835810818\",\n            \"object-locator\": {\n                \"schema-name\": \"%\",\n                \"table-name\": \"%\"\n            },\n            \"rule-action\": \"include\",\n            \"filters\": []\n        }\n    ]\n}",
                "ReplicationTaskSettings": "{\n    \"TargetMetadata\": {\n        \"TargetSchema\": \"\",\n        \"SupportLobs\": true,\n        \"FullLobMode\": false,\n        \"LobChunkSize\": 64,\n        \"LimitedSizeLobMode\": true,\n        \"LobMaxSize\": 32,\n        \"InlineLobMaxSize\": 0,\n        \"LoadMaxFileSize\": 0,\n        \"ParallelLoadThreads\": 0,\n        \"ParallelLoadBufferSize\": 0,\n        \"BatchApplyEnabled\": false,\n        \"TaskRecoveryTableEnabled\": false,\n        \"ParallelLoadQueuesPerThread\": 0,\n        \"ParallelApplyThreads\": 0,\n        \"ParallelApplyBufferSize\": 0,\n        \"ParallelApplyQueuesPerThread\": 0\n    },\n    \"FullLoadSettings\": {\n        \"TargetTablePrepMode\": \"TRUNCATE_BEFORE_LOAD\",\n        \"CreatePkAfterFullLoad\": false,\n        \"StopTaskCachedChangesApplied\": false,\n        \"StopTaskCachedChangesNotApplied\": false,\n        \"MaxFullLoadSubTasks\": 8,\n        \"TransactionConsistencyTimeout\": 600,\n        \"CommitRate\": 10000\n    },\n    \"Logging\": {\n        \"EnableLogging\": true,\n        \"EnableLogContext\": false,\n        \"LogComponents\": [\n            {\n                \"Id\": \"SOURCE_UNLOAD\",\n                \"Severity\": \"LOGGER_SEVERITY_DEFAULT\"\n            },\n            {\n                \"Id\": \"SOURCE_CAPTURE\",\n                \"Severity\": \"LOGGER_SEVERITY_DEFAULT\"\n            },\n            {\n                \"Id\": \"TARGET_LOAD\",\n                \"Severity\": \"LOGGER_SEVERITY_DEFAULT\"\n            },\n            {\n                \"Id\": \"TARGET_APPLY\",\n                \"Severity\": \"LOGGER_SEVERITY_DEFAULT\"\n            },\n            {\n                \"Id\": \"TASK_MANAGER\",\n                \"Severity\": \"LOGGER_SEVERITY_DEFAULT\"\n            }\n        ],\n        \"CloudWatchLogGroup\": null,\n        \"CloudWatchLogStream\": null\n    },\n    \"ControlTablesSettings\": {\n        \"ControlSchema\": \"\",\n        \"HistoryTimeslotInMinutes\": 5,\n        \"HistoryTableEnabled\": false,\n        \"SuspendedTablesTableEnabled\": false,\n        \"StatusTableEnabled\": false\n    },\n    \"StreamBufferSettings\": {\n        \"StreamBufferCount\": 3,\n        \"StreamBufferSizeInMB\": 8,\n        \"CtrlStreamBufferSizeInMB\": 5\n    },\n    \"ChangeProcessingDdlHandlingPolicy\": {\n        \"HandleSourceTableDropped\": true,\n        \"HandleSourceTableTruncated\": true,\n        \"HandleSourceTableAltered\": true\n    },\n    \"ErrorBehavior\": {\n        \"DataErrorPolicy\": \"LOG_ERROR\",\n        \"DataTruncationErrorPolicy\": \"LOG_ERROR\",\n        \"DataErrorEscalationPolicy\": \"SUSPEND_TABLE\",\n        \"DataErrorEscalationCount\": 0,\n        \"TableErrorPolicy\": \"SUSPEND_TABLE\",\n        \"TableErrorEscalationPolicy\": \"STOP_TASK\",\n        \"TableErrorEscalationCount\": 0,\n        \"RecoverableErrorCount\": -1,\n        \"RecoverableErrorInterval\": 5,\n        \"RecoverableErrorThrottling\": true,\n        \"RecoverableErrorThrottlingMax\": 1800,\n        \"RecoverableErrorStopRetryAfterThrottlingMax\": false,\n        \"ApplyErrorDeletePolicy\": \"IGNORE_RECORD\",\n        \"ApplyErrorInsertPolicy\": \"LOG_ERROR\",\n        \"ApplyErrorUpdatePolicy\": \"LOG_ERROR\",\n        \"ApplyErrorEscalationPolicy\": \"LOG_ERROR\",\n        \"ApplyErrorEscalationCount\": 0,\n        \"ApplyErrorFailOnTruncationDdl\": false,\n        \"FullLoadIgnoreConflicts\": true,\n        \"FailOnTransactionConsistencyBreached\": false,\n        \"FailOnNoTablesCaptured\": true\n    },\n    \"ChangeProcessingTuning\": {\n        \"BatchApplyPreserveTransaction\": true,\n        \"BatchApplyTimeoutMin\": 1,\n        \"BatchApplyTimeoutMax\": 30,\n        \"BatchApplyMemoryLimit\": 500,\n        \"BatchSplitSize\": 0,\n        \"MinTransactionSize\": 1000,\n        \"CommitTimeout\": 1,\n        \"MemoryLimitTotal\": 1024,\n        \"MemoryKeepTime\": 60,\n        \"StatementCacheSize\": 50\n    },\n    \"ValidationSettings\": {\n        \"EnableValidation\": false,\n        \"ValidationMode\": \"ROW_LEVEL\",\n        \"ThreadCount\": 5,\n        \"FailureMaxCount\": 10000,\n        \"TableFailureMaxCount\": 1000,\n        \"HandleCollationDiff\": false,\n        \"ValidationOnly\": false,\n        \"RecordFailureDelayLimitInMinutes\": 0,\n        \"SkipLobColumns\": false,\n        \"ValidationPartialLobSize\": 0,\n        \"ValidationQueryCdcDelaySeconds\": 0,\n        \"PartitionSize\": 10000\n    },\n    \"PostProcessingRules\": null,\n    \"CharacterSetSettings\": null,\n    \"LoopbackPreventionSettings\": null,\n    \"BeforeImageSettings\": null\n}"
            }
        }
    }
}

