{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "EventBridge rules to log Network Manager events.",
    "Parameters": {},
    "Resources": {
        "CWLTopologyChanges": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "LogGroupName": "/aws/events/network_manager_topology_changes"
            }
        },
        "CWLRoutingUpdates": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "LogGroupName": "/aws/events/network_manager_routing_updates"
            }
        },
        "CWLStatusUpdates": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "LogGroupName": "/aws/events/network_manager_status_updates"
            }
        },
        "CWLPeeringConnectionDeleted": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "LogGroupName": "/aws/events/network_manager_peering_connection_deleted"
            }
        },
        "CWLRouteDeleted": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "LogGroupName": "/aws/events/network_manager_route_deleted"
            }
        },
        "CWLVPNConnectionDown": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
                "LogGroupName": "/aws/events/network_manager_vpn_connection_down"
            }
        },
        "RuleTopologyChanges": {
            "Type": "AWS::Events::Rule",
            "Properties": {
                "Name": "Network_Manager_Topology_Changes",
                "Description": "Capture Network Manger Topology Changes",
                "EventPattern": {
                    "source": [
                        "aws.networkmanager"
                    ],
                    "detail-type": [
                        "Network Manager Topology Change"
                    ]
                },
                "Targets": [
                    {
                        "Id": "CW-Logs-Network-Manager-Toplogy-Changes",
                        "Arn": {
                            "Fn::GetAtt": [
                                "CWLTopologyChanges",
                                "Arn"
                            ]
                        }
                    }
                ]
            }
        },
        "RuleRoutingUpdates": {
            "Type": "AWS::Events::Rule",
            "Properties": {
                "Name": "Network_Manager_Routing_Updates",
                "Description": "Capture Network Manger Routing Updates",
                "EventPattern": {
                    "source": [
                        "aws.networkmanager"
                    ],
                    "detail-type": [
                        "Network Manager Routing Update"
                    ]
                },
                "Targets": [
                    {
                        "Id": "CW-Logs-Network-Manager-Routing-Updates",
                        "Arn": {
                            "Fn::GetAtt": [
                                "CWLRoutingUpdates",
                                "Arn"
                            ]
                        }
                    }
                ]
            }
        },
        "RuleStatusUpdates": {
            "Type": "AWS::Events::Rule",
            "Properties": {
                "Name": "Network_Manager_Status-Updates",
                "Description": "Capture Network Manger Status Updates",
                "EventPattern": {
                    "source": [
                        "aws.networkmanager"
                    ],
                    "detail-type": [
                        "Network Manager Status Update"
                    ]
                },
                "Targets": [
                    {
                        "Id": "CW-Logs-Network-Manager-Status-Updates",
                        "Arn": {
                            "Fn::GetAtt": [
                                "CWLStatusUpdates",
                                "Arn"
                            ]
                        }
                    }
                ]
            }
        },
        "RulePeeringConnectionDeleted": {
            "Type": "AWS::Events::Rule",
            "Properties": {
                "Name": "Network_Manager_Peering_Connection_Deleted",
                "Description": "Capture Network Manger Peering Connection Deleted",
                "EventPattern": {
                    "source": [
                        "aws.networkmanager"
                    ],
                    "detail-type": [
                        "Network Manager Topology Change"
                    ],
                    "detail": {
                        "changeType": [
                            "TGW-PEERING-DELETED"
                        ],
                        "transitGatewayArn": [
                            "arn:aws:ec2:us-east-1:123456789012:transit-gateway/tgw-1234567890abcdef0"
                        ]
                    }
                },
                "Targets": [
                    {
                        "Id": "CW-Logs-Network-Manager-Peering-Connection-Deleted",
                        "Arn": {
                            "Fn::GetAtt": [
                                "CWLPeeringConnectionDeleted",
                                "Arn"
                            ]
                        }
                    }
                ]
            }
        },
        "RuleRouteDeleted": {
            "Type": "AWS::Events::Rule",
            "Properties": {
                "Name": "Network_Manager_Route_Deleted",
                "Description": "Capture Network Manger Route Deleted",
                "EventPattern": {
                    "source": [
                        "aws.networkmanager"
                    ],
                    "detail-type": [
                        "Network Manager Routing Update"
                    ],
                    "detail": {
                        "changeType": [
                            "TGW-ROUTE-UNINSTALLED"
                        ],
                        "transitGatewayArn": [
                            "arn:aws:ec2:us-west-2:123456789012:transit-gateway/tgw-1234567890abcdef0"
                        ],
                        "region": [
                            "us-west-2"
                        ]
                    }
                },
                "Targets": [
                    {
                        "Id": "CW-Logs-Network-Manager-Route-Deleted",
                        "Arn": {
                            "Fn::GetAtt": [
                                "CWLRouteDeleted",
                                "Arn"
                            ]
                        }
                    }
                ]
            }
        },
        "RuleVPNConnectionDown": {
            "Type": "AWS::Events::Rule",
            "Properties": {
                "Name": "Network_Manager_VPN_Connection_Down",
                "Description": "Capture Network Manger VPN Connection Down",
                "EventPattern": {
                    "source": [
                        "aws.networkmanager"
                    ],
                    "detail-type": [
                        "Network Manager Status Update"
                    ],
                    "detail": {
                        "changeType": [
                            "VPN-CONNECTION-BGP-DOWN"
                        ],
                        "transitGatewayArn": [
                            "arn:aws:ec2:us-west-2:111122223333:transit-gateway/tgw-1234567890abcdef0"
                        ],
                        "transitGatewayAttachmentArn": [
                            "arn:aws:ec2:us-west-2:111122223333:transit-gateway-attachment/tgw-attach-1234567890abcdef0"
                        ],
                        "region": [
                            "us-west-2"
                        ]
                    }
                },
                "Targets": [
                    {
                        "Id": "CW-Logs-Network-Manager-VPN-Connection-Down",
                        "Arn": {
                            "Fn::GetAtt": [
                                "CWLVPNConnectionDown",
                                "Arn"
                            ]
                        }
                    }
                ]
            }
        }
    }
}