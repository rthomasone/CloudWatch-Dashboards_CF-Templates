{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "CloudWatch Dashboard to analyze Network Manager events logged to CloudWatch Logs. These log events were written by EventBridge service.",
    "Resources": {
        "CWDNetworkManager": {
            "Type": "AWS::CloudWatch::Dashboard",
            "Properties": {
                "DashboardName": "Network_Manager_Events",
                "DashboardBody": "{\n    \"widgets\": [\n        {\n            \"type\": \"log\",\n            \"x\": 0,\n            \"y\": 12,\n            \"width\": 24,\n            \"height\": 6,\n            \"properties\": {\n                \"query\": \"SOURCE '/aws/events/network_manager_routing_updates' | #Details on Routing Updates\\nfields time, detail.changeType as Change_Type, detail.region as Region, detail.routes.0.attachments.0.resourceId as TGW_ID, detail.routes.0.attachments.0.tgwAttachmentId as TGW_Attach_ID,detail.routes.0.routeType as Route_Type, detail.routes.0.destinationCidrBlock as CIDR, detail.changeDescription as Description\\n| sort @timestamp desc\",\n                \"region\": \"us-west-2\",\n                \"stacked\": false,\n                \"title\": \"Routing Updates\",\n                \"view\": \"table\"\n            }\n        },\n        {\n            \"type\": \"log\",\n            \"x\": 0,\n            \"y\": 6,\n            \"width\": 24,\n            \"height\": 6,\n            \"properties\": {\n                \"query\": \"SOURCE '/aws/events/network_manager_topology_changes' | #Details on Topology Change\\nfields time, detail.changeType as ChangeType, detail.region as Region, detail.changeDescription as Description\\n| parse detail.transitGatewayArn \\\"arn:aws:ec2:*:*:transit-gateway/*\\\" as TGW_Region, TGW_Account_ID, TGW_ID\\n| parse detail.transitGatewayAttachmentArn \\\"arn:aws:ec2:*:*:transit-gateway-attachment/*\\\" as Attach_Region, Attach_AccountID, TGW_Attach_ID\\n| parse detail.peeredTransitGatewayArn \\\"arn:aws:ec2:*:*:transit-gateway/*\\\" as Peer_TGW_Region, Peer_TGW_AccountID, Peer_TGW_ID\\n| display time, detail.changeType as Change_Type, detail.region as Region, TGW_Account_ID, TGW_ID, TGW_Attach_ID, Peer_TGW_ID, detail.changeDescription as Description\\n| sort @timestamp desc\",\n                \"region\": \"us-west-2\",\n                \"stacked\": false,\n                \"title\": \"Topology Updates\",\n                \"view\": \"table\"\n            }\n        },\n        {\n            \"type\": \"log\",\n            \"x\": 0,\n            \"y\": 18,\n            \"width\": 24,\n            \"height\": 6,\n            \"properties\": {\n                \"query\": \"SOURCE '/aws/events/network_manager_status_updates' | #Details on Status Update\\nfields time, detail.changeType as ChangeType, detail.region as Region, detail.peerAsn as Peer_ASN, detail.outsideIpAddress as Outside_IP, detail.changeDescription as Description\\n| parse detail.transitGatewayArn \\\"arn:aws:ec2:*:*:transit-gateway/*\\\" as TGW_Region, TGW_Account_ID, TGW_ID\\n| parse detail.transitGatewayAttachmentArn \\\"arn:aws:ec2:*:*:transit-gateway-attachment/*\\\" as Attach_Region, Attach_AccountID, TGW_Attach_ID\\n| parse detail.vpnConnectionArn \\\"arn:aws:ec2:*:*:vpn-connection/*\\\" as VPN_Region, VPN_AccountID, VPN_ID\\n| display time, detail.changeType as Change_Type, detail.region as Region, TGW_Account_ID, TGW_ID, TGW_Attach_ID, VPN_ID, Peer_ASN, Outside_IP, detail.changeDescription as Description\\n| sort @timestamp desc\",\n                \"queryLanguage\": \"CWLI\",\n                \"region\": \"us-west-2\",\n                \"title\": \"Status Updates\",\n                \"view\": \"table\"\n            }\n        },\n        {\n            \"type\": \"log\",\n            \"x\": 0,\n            \"y\": 0,\n            \"width\": 24,\n            \"height\": 6,\n            \"properties\": {\n                \"query\": \"SOURCE '/aws/events/networkmanagerloggroup' START=-86400 END=0s |  fields detail.region as Region, detail.changeDescription as Message, resources.1 as Resource,  @timestamp as Timestamp\\n\\n\\n\\n\\n\\n\\n\\n    | filter resources.0\\n\\n\\n\\n= \\\"arn:aws:networkmanager::123456789012:global-network/global-network-089c02305e1bda2c3\\\" and resources.1 not like 'core-network-'\\n\\n\\n\\n\\n\\n\\n\\n    | sort @timestamp desc\\n\\n\\n\\n\\n\\n\\n\\n    | limit 200\",\n                \"view\": \"table\",\n                \"stacked\": false,\n                \"title\": \"All Network Manager Events\"\n            }\n        }\n    ]\n}"
            }
        }
    }
}